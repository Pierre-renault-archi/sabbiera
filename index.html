<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>sabberia</title>

<style>
:root{
  --bg:#ffffff;
  --text:#111;
  --gap:8px;
}
*{box-sizing:border-box}


body{
  margin:0;
  font-family:   Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, 'Times New Roman', Times, serif  ;
  color:var(--text);
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
    overflow-x: hidden;   /* emp√™che tout scroll horizontal */
  max-width: 100%;
}

/* ---------------- Position des deux √©l√©ments fixes ---------------- */
#filtersHeader {
  position: fixed;
  top: 16px;
  left: 16px;
  z-index: 50;
  display: flex;
  gap: 200px;
  flex-wrap: wrap;
  transition: opacity 0.3s ease;
}
#filtersHeader.filters-collapsed {
  opacity:0;
  pointer-events:none;
}

#sabbieraContainer {
  position: fixed;
  bottom: 16px;
  right: 16px;
  z-index: 100;
}

#sabbiera-image {
  width: 80vw;    /* taille adaptable */
  height: auto;
  cursor: pointer;
}


.chip{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:6px 12px;
  border-radius:999px;
  background:transparent;
  color:#e93d4d;
  cursor:pointer;
  user-select:none;
  border:1px solid #e93d4d;
  font-size:14px;
  margin: 2px;
}


.chip.active{ background:#e93d4d; color:#fff; border-color:rgba(170,80,137,.15) }
.chip .count{ font-weight:700; opacity:.9; font-size:12px }

main{ 
  position: relative;
  width: 100%;
  margin: 0;
  padding-top: 5px;
}

.grid{
  display:flex;
  flex-direction:column;
  align-items:center;
  width:100%;
  gap:6px;
}

.card{
  position:relative;
  margin:0;
  cursor:pointer;
  display:flex;
  justify-content:center;
}

.thumb {
  display:block;
  width:auto;
  height:auto;
  object-fit:contain;
  background:#000;
  user-select:none;
  -webkit-user-drag:none;
  transition:opacity 0.3s ease;
}

.overlay {
  position:absolute;
  inset:0;
  background:#e93d4e78;
  color:#fff;
  display:flex;
  opacity:0;
  pointer-events:none;
  transition:opacity 0.3s ease;
  padding:20px;
}
.card.show-overlay .overlay {
  opacity:1;
  pointer-events:auto;
}
.overlay .title {
  font-size:18px;
  position:absolute;
  top:50px;
  left:100px;
  font-size:18px;
  font-weight:600;
  color:#fff;
   max-width: 90%;       /* au maximum 90% de la largeur de l‚Äôimage */
  width: auto;           /* prend la place n√©cessaire */
  word-wrap: break-word; /* casse les mots longs si n√©cessaire */
  overflow-wrap: break-word;
  white-space: normal;
  margin-right: 10px;

  max-width: 80%;
  white-space: normal;
  word-wrap: break-word;
}
.overlay .tags {
  font-size:14px;
  position:absolute;
  bottom:50px;
  left:30px;
  font-size:14px;
  color:#fff;
  opacity:1;
    font-family: 'Times New Roman', Times, serif;

}
.overlay .download-btn{
  margin-top:10px;
  padding:6px 12px;
  background:transparent;
  color:#e93d4d;
  border-radius:6px;
  text-decoration:none;
  font-size:14px;
    border:1px solid #e93d4d;
    position:absolute;
  bottom:100px;
  right:150px;
  padding:6px 12px;
  border-radius:6px;

}
.overlay .download-btn:hover{
  background: transparent;
}

footer{ padding:30px; text-align:center; color:#777; font-size:13px ; 
}

.extra-image {
  position: fixed;
  bottom: 18vw;   /* un peu au-dessus de Sabbiera par ex */
  left: 0px;
  width: 30vw;    /* taille adaptable */
  height: auto;
  cursor: pointer;
  z-index: 100;    /* au-dessus du contenu */
  rotate: 90deg;
}

a {
 color: #e93d4d;
}

.center-text {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: left;
  color: #e93d4d;
  padding: 20px;
  border-radius: 12px;
  z-index: 60; /* au-dessus du reste */
  max-width: 20%;   /* ‚úÖ colonne r√©duite, ex : 40% de la largeur de l‚Äô√©cran */
  font-family: 'Times New Roman', Times, serif;
  font-size: 20px;
  
}
/* üì± Sur t√©l√©phone (max 600px de large), on √©largit la colonne */
@media (max-width: 600px) {
  .center-text {
    max-width: 80%;  /* prend presque tout l‚Äô√©cran sur mobile */
    font-size: 16px; /* texte un peu plus petit si besoin */
    font-family: 'Times New Roman', Times, serif;

  }
}
.no-result {
  text-align: center;
  color: #e93d4d;
  font-family: 'Times New Roman', serif;
  font-size: 20px;
  padding: 40px 20px;
}



</style>
</head>
<body>

<!-- Header fixe pour filtres -->
<header id="filtersHeader">
  <div class="filters" id="filters"></div>
</header>

<a href="https://pierre-renault-archi.github.io/pratiq/" target="_blank" id="extraLink">
  <img src="images/pratiq.png" alt="Aller au lien" class="extra-image">
</a>




<!-- Sabbiera fixe en bas √† droite -->
<div id="sabbieraContainer">
  <img id="sabbiera-image" src="images/sabbiera2.2.png" alt="Sabbiera">
</div>


<div id="centerText" class="center-text">
['sab'bj…õra] n.f 
<br>spazio circoscritto contenente sabbia, situato nei parchi per giochi da spiaggia. 
<br>
<br>Exercice photographique, d'√©criture machine et graphique pour partager ma mobilit√© en Italie. 

</div>

<main>
  <section class="grid" id="grid"></section>
</main>

<footer>
  <br>
  <br>
  <br>
  <br>
  2025 Pierre Renault |  <a href="https://www.linkedin.com/in/pierre-renault-54a83a268/">linkedin</a> |  <a href="https://www.instagram.com/pratiq___/?igsh=cmxneHA1MnV4aDlj&utm_source=qr">instagram</a>
  <br>
  <br>
  <br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
</footer>

<script>
/* ---------------- Donn√©es ---------------- */
const DATA = [
  {id:1, title:" <i> 28/09/2025  <br> [MILANO, Italia] </i>  <br> On d√©couvre le quartier de Navigli avec Warre et Justine : un march√© qui longe le canal, des impasses comme r√©sidences d'artistes. Lieu touristique oblige, on tombe sur un groupe de retrait√©s. Je les photographie.", tags:["warre","justine"], img:"images/navigli 01.jpg"},
  {id:1, title:" <i> 28/09/2025  <br> [MILANO, Italia] </i>  <br> Au bord du canal de Navigli, sacralis√© comme patrimoine en France, ici tagu√©.", tags:["warre","justine"], img:"images/navigli 02.jpg"},

  {id:1, title:" <i>12/09/2025<br> [VARENNA, Italia] </i><br> ", tags:["justine", "sixtine"], img:"images/varenna 02.jpg"},
  {id:1, title:" <i>12/09/2025<br> [BELLAGIO, Italia] </i><br> ", tags:["justine", "sixtine"], img:"images/bellagio 03.jpg"},
  {id:1, title:" <i>12/09/2025<br> [BELLAGIO, Italia] </i><br> ", tags:["justine", "sixtine"], img:"images/bellagio 02.jpg"},
  {id:1, title:" <i>12/09/2025<br> [BELLAGIO, Italia] </i><br> ", tags:["justine", "sixtine"], img:"images/bellagio 01.jpg"},
  {id:1, title:" <i>12/09/2025<br> [BELLAGIO, Italia] </i><br> ", tags:["justine", "sixtine", "l'inconnu"], img:"images/bellagio 04.jpg"},
  {id:1, title:" <i>12/09/2025<br> [VARENNA, Italia] </i><br> ", tags:["justine", "sixtine" ], img:"images/varenna 01.jpg"},
 

  {id:1, title:" <i>11/09/2025<br> [MILANO, Italia] </i><br> Je me dirige vers le quartier de Brera.<br> Je pose le v√©lo devant ce kiosque au milieu d'un carrefour routier.<br> Echange de regard.", tags:["l'inconnu"], img:"images/milan 01.jpg"},

];

/* ---------------- Collecter les tags ---------------- */
function collectTags(data){
  const map = {};
  data.forEach(item=>{
    item.tags.forEach(t=>{
      map[t] = (map[t]||0)+1;
    });
  });
  return map;
}
const tagMap = collectTags(DATA);

const filtersEl = document.getElementById('filters');
const gridEl = document.getElementById('grid');
let activeFilters = [];

/* Lire les filtres URL */
(function readFiltersFromURL(){
  const params = new URLSearchParams(location.search);
  const f = params.get('filters');
  if(f) activeFilters = f.split(',').map(s=>s.trim()).filter(Boolean);
})();

/* Construire les chips */
function renderChips(){
  filtersEl.innerHTML='';
  const allChip = document.createElement('div');
  allChip.className='chip'+(activeFilters.length===0?' active':'');
  allChip.textContent='tutti';
  allChip.onclick=()=>{activeFilters=[]; update();};
  filtersEl.appendChild(allChip);

  Object.keys(tagMap).sort().forEach(tag=>{
    const c=document.createElement('div');
    c.className='chip'+(activeFilters.includes(tag)?' active':'');
    c.innerHTML=`<span>${tag}</span> `;
    c.onclick=()=>{
      if(activeFilters.includes(tag)) activeFilters=activeFilters.filter(t=>t!==tag);
      else activeFilters.push(tag);
      update();
    };
    filtersEl.appendChild(c);
  });
}

/* Filtrage */
function matchesFilters(item){
  if(activeFilters.length===0) return true;
  return activeFilters.every(f=>item.tags.includes(f));
}

function renderGrid(){
  // debug
  console.log('renderGrid -> activeFilters:', activeFilters);

  // filtrer et vider la grille
  const visible = DATA.filter(matchesFilters);
  gridEl.innerHTML = '';

  // cas : aucun r√©sultat
  if (visible.length === 0) {
    var no = document.createElement('div');
    no.className = 'no-result';
    no.textContent = 'Auncun moment pass√© avec ces personnes r√©unies, ou non immortalis√© du moins.';
    gridEl.appendChild(no);
    return;
  }

  // calculer la minWidth en chargeant les images (s√©curis√©)
  var minWidth = Infinity;
  var promises = visible.map(function(item){
    return new Promise(function(resolve){
      var img = new Image();
      img.src = item.img;
      img.onload = function(){
        if (img.naturalWidth && img.naturalHeight) {
          var widthForMaxHeight = (img.naturalWidth / img.naturalHeight) * window.innerHeight * 0.95;
          if (widthForMaxHeight < minWidth) minWidth = widthForMaxHeight;
        }
        resolve();
      };
      img.onerror = function(){
        // ne bloque pas le rendu si l'image est introuvable
        resolve();
      };
      // s√©curit√© : si on n'a ni load ni error
      setTimeout(resolve, 1000);
    });
  });

  Promise.all(promises).then(function(){
    if (!isFinite(minWidth)) {
      minWidth = Math.min(window.innerWidth * 0.9, 800);
    }

    visible.forEach(function(item){
      var a = document.createElement('article');
      a.className = 'card';

      // image
      var imgEl = document.createElement('img');
      imgEl.className = 'thumb';
      imgEl.src = item.img;
      imgEl.alt = item.title || '';
      imgEl.style.width = minWidth + 'px';
      imgEl.onerror = function(){ imgEl.style.display = 'none'; };

      // overlay
      var overlay = document.createElement('div');
      overlay.className = 'overlay';

      var titleDiv = document.createElement('div');
      titleDiv.className = 'title';
      // item.title contient parfois des <br> ou <i>, on veut autoriser le HTML
      titleDiv.innerHTML = item.title || '';

      var tagsDiv = document.createElement('div');
      tagsDiv.className = 'tags';
      tagsDiv.textContent = (item.tags || []).map(function(t){ return '#' + t; }).join(' ');

      var downloadBtn = document.createElement('a');
      downloadBtn.className = 'download-btn';
      downloadBtn.href = item.img;
      downloadBtn.download = String((item.title || 'image').replace(/\s+/g,'_')) + '.jpg';
      downloadBtn.textContent = 'T√©l√©charger';

      overlay.appendChild(titleDiv);
      overlay.appendChild(tagsDiv);
      overlay.appendChild(downloadBtn);

      a.appendChild(imgEl);
      a.appendChild(overlay);

      a.addEventListener('click', function(){ a.classList.toggle('show-overlay'); });

      gridEl.appendChild(a);
    });
  });
}

/* Mise √† jour */
function update(push=true){
  renderChips();
  renderGrid();
  const params = new URLSearchParams(location.search);
  if(activeFilters.length) params.set('filters',activeFilters.join(','));
  else params.delete('filters');
  const newurl = location.pathname + (params.toString()? '?'+params.toString():'');
  if(push) history.replaceState(null,'',newurl);
}

/* Toggle Sabbiera pour masquer/afficher le menu des filtres */
document.addEventListener('DOMContentLoaded', () => {
  const sabbieraImage = document.getElementById('sabbiera-image');
  const filtersHeader = document.getElementById('filtersHeader');
  const extraLink = document.getElementById('extraLink'); // üîπ nouvel √©l√©ment fixe
  const centerText = document.getElementById('centerText'); // üîπ nouvel √©l√©ment

  sabbieraImage.setAttribute('aria-expanded', 'true');

  sabbieraImage.addEventListener('click', () => {
    filtersHeader.classList.toggle('filters-collapsed');
    const collapsed = filtersHeader.classList.contains('filters-collapsed');
    sabbieraImage.setAttribute('aria-expanded', String(!collapsed));

    // üîπ cacher/afficher aussi l‚Äôimage-lien
    if (extraLink) {
      extraLink.style.display = collapsed ? 'none' : 'block';
    }
    if (centerText) {
      centerText.style.display = collapsed ? "none" : "block";
    }
  });
});



/* Initialisation */
update(false);
</script>
</body>
</html>
